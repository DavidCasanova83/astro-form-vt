---
import Header from '../../components/Header.astro';
import "../../styles/global.css";
---
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <title x-text="city + ' - Formulaire étape 2'">Formulaire - Étape 2</title>
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
  </head>
  <body class="bg-gray-100 text-gray-800">
    <Header />
    <main class="container mx-auto p-4" x-data="{ 
      city: '',
      profile: '', 
      ageGroups: [], 
      formAnswers: {} 
    }" x-init="
      city = window.location.pathname.split('/')[1]; // Récupération automatique de la ville
      formAnswers = JSON.parse(localStorage.getItem('formAnswers') || '{}');
    ">
      <h1 class="text-3xl font-bold mb-4">Formulaire <span x-text="city"></span> - Étape 2</h1>

      <!-- Question 1 : Profil -->
      <p class="text-xl mb-4">Quel est votre profil ?</p>
      <div class="flex space-x-4 mb-4">
        <button 
          x-on:click="profile = 'Seul'" 
          :class="profile === 'Seul' ? 'bg-blue-500 text-white' : 'bg-gray-200 text-black'" 
          class="px-4 py-2 rounded hover:bg-blue-400">
          Seul
        </button>
        <button 
          x-on:click="profile = 'Couple'" 
          :class="profile === 'Couple' ? 'bg-blue-500 text-white' : 'bg-gray-200 text-black'" 
          class="px-4 py-2 rounded hover:bg-blue-400">
          Couple
        </button>
        <button 
          x-on:click="profile = 'Famille'" 
          :class="profile === 'Famille' ? 'bg-blue-500 text-white' : 'bg-gray-200 text-black'" 
          class="px-4 py-2 rounded hover:bg-blue-400">
          Famille
        </button>
        <button 
          x-on:click="profile = 'Groupe d’amis'" 
          :class="profile === 'Groupe d’amis' ? 'bg-blue-500 text-white' : 'bg-gray-200 text-black'" 
          class="px-4 py-2 rounded hover:bg-blue-400">
          Groupe d’amis
        </button>
      </div>

      <!-- Question 2 : Tranche d’âge -->
      <p class="text-xl mb-4">Quelle(s) tranche(s) d’âge vous correspond(ent) ?</p>
      <div class="flex space-x-4 mb-4">
        <button 
          x-on:click="ageGroups.includes('18-25') ? ageGroups.splice(ageGroups.indexOf('18-25'), 1) : ageGroups.push('18-25')" 
          :class="ageGroups.includes('18-25') ? 'bg-blue-500 text-white' : 'bg-gray-200 text-black'" 
          class="px-4 py-2 rounded hover:bg-blue-400">
          18 - 25 ans
        </button>
        <button 
          x-on:click="ageGroups.includes('25-40') ? ageGroups.splice(ageGroups.indexOf('25-40'), 1) : ageGroups.push('25-40')" 
          :class="ageGroups.includes('25-40') ? 'bg-blue-500 text-white' : 'bg-gray-200 text-black'" 
          class="px-4 py-2 rounded hover:bg-blue-400">
          25 - 40 ans
        </button>
        <button 
          x-on:click="ageGroups.includes('40-60') ? ageGroups.splice(ageGroups.indexOf('40-60'), 1) : ageGroups.push('40-60')" 
          :class="ageGroups.includes('40-60') ? 'bg-blue-500 text-white' : 'bg-gray-200 text-black'" 
          class="px-4 py-2 rounded hover:bg-blue-400">
          40 - 60 ans
        </button>
        <button 
          x-on:click="ageGroups.includes('60+') ? ageGroups.splice(ageGroups.indexOf('60+'), 1) : ageGroups.push('60+')" 
          :class="ageGroups.includes('60+') ? 'bg-blue-500 text-white' : 'bg-gray-200 text-black'" 
          class="px-4 py-2 rounded hover:bg-blue-400">
          60 ans et plus
        </button>
      </div>

      <!-- Bouton de validation -->
      <button
        x-on:click="if(profile && ageGroups.length > 0){ 
          formAnswers.profile = profile;
          formAnswers.ageGroups = ageGroups;
          localStorage.setItem('formAnswers', JSON.stringify(formAnswers));
          console.log('Form2 - Données sauvegardées : ', JSON.parse(localStorage.getItem('formAnswers')));

          // Redirige vers l'étape 3 en conservant la ville détectée
          window.location.href='/' + city + '/form3';
        } else { 
          alert('Veuillez sélectionner un profil et au moins une tranche d’âge'); 
        }"
        class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded">
        Valider
      </button>
    </main>
  </body>
</html>
