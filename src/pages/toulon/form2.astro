---
import Header from '../../components/Header.astro';
import "../../styles/global.css";
---
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <title>Toulon - Formulaire étape 2</title>
    <!-- Inclusion d'AlpineJS -->
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
  </head>
  <body class="bg-gray-100 text-gray-800">
    <Header />
    <!-- Conteneur AlpineJS pour la deuxième étape -->
    <main class="container mx-auto p-4" x-data="{ status: '', formAnswers: {} }" x-init="formAnswers = JSON.parse(localStorage.getItem('formAnswers') || '{}')">
      <h1 class="text-3xl font-bold mb-4">Formulaire Toulon - Étape 2</h1>
      
      <p class="text-xl mb-4">Êtes-vous en famille, seul ou en couple ?</p>
      <div class="flex space-x-4 mb-4">
        <button 
          x-on:click="status = 'Famille'" 
          :class="status === 'Famille' ? 'bg-blue-500 text-white' : 'bg-gray-200 text-black'" 
          class="px-4 py-2 rounded hover:bg-blue-400">
          Famille
        </button>
        <button 
          x-on:click="status = 'Seul'" 
          :class="status === 'Seul' ? 'bg-blue-500 text-white' : 'bg-gray-200 text-black'" 
          class="px-4 py-2 rounded hover:bg-blue-400">
          Seul
        </button>
        <button 
          x-on:click="status = 'Couple'" 
          :class="status === 'Couple' ? 'bg-blue-500 text-white' : 'bg-gray-200 text-black'" 
          class="px-4 py-2 rounded hover:bg-blue-400">
          Couple
        </button>
      </div>

       <!-- Bouton de validation pour l'étape 2 -->
       <button
       x-on:click="if(status){ 
         formAnswers.status = status;
         localStorage.setItem('formAnswers', JSON.stringify(formAnswers));
         console.log('Form2 - Données sauvegardées : ', JSON.parse(localStorage.getItem('formAnswers')));
         
         // Appel à l'endpoint pour enregistrer les données dans data/answers.json
         fetch('/api/saveAnswer', {
           method: 'POST',
           headers: { 'Content-Type': 'application/json' },
           body: JSON.stringify(formAnswers)
         })
         .then(response => response.json())
         .then(data => {
           console.log('Réponse du serveur : ', data);
           alert('Données enregistrées sur le serveur !');
           // Redirige vers une page de résumé si besoin :
           // window.location.href='/toulon/summary';
         })
         .catch(error => {
           console.error('Erreur lors de la sauvegarde : ', error);
           alert('Erreur lors de la sauvegarde sur le serveur');
         });
       } else { 
         alert('Veuillez sélectionner une option'); 
       }"
       class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded">
       Valider
     </button>
    </main>
  </body>
</html>
