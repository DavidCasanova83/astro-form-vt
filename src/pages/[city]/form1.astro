---
import Header from '../../components/Header.astro';
import "../../styles/global.css";
import cities from '../../data/cities.json'; // ðŸ”¥ Import des villes dynamiques

// Astro doit savoir quelles pages gÃ©nÃ©rer avant le build
export async function getStaticPaths() {
  return cities.map(city => ({ params: { city } }));
}
---

<html lang="fr">
<head>
    <meta charset="UTF-8" />
    <title>Formulaire Ã‰tape 1</title>
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
</head>
<body class="bg-gray-100 text-gray-800">
    <Header />
    <main class="container mx-auto p-4 max-w-lg"
        x-init="
            city = window.location.pathname.split('/')[1];
            document.title = 'Formulaire - ' + city + ' - Ã‰tape 1';
            $watch('formAnswers', value => localStorage.setItem('formAnswers', JSON.stringify(value)))"
        x-data="{ 
            city:'', 
            country: 'France', 
            contactMode: 'Accueil physique', 
            formAnswers: JSON.parse(localStorage.getItem('formAnswers') || '{}') 
        }"
        x-init="$watch('formAnswers', value => localStorage.setItem('formAnswers', JSON.stringify(value)))">
      
        <h1 class="text-3xl font-bold mb-4">Formulaire - <span x-text="city"></span> - Ã‰tape 1</h1>
      
        <!-- Question 1 : Pays de rÃ©sidence -->
        <p class="text-xl mb-4">Quel est votre pays de rÃ©sidence ?</p>
        <div class="flex flex-wrap justify-start gap-2 md:gap-4 mb-4">
            <template x-for="option in ['France', 'Angleterre', 'Allemagne']">
                <button 
                    type="button"
                    x-on:click="country = option"
                    :class="country === option ? 'bg-blue-500 text-white' : 'bg-gray-200 text-black'"
                    class="w-full md:w-auto px-4 py-2 rounded hover:bg-blue-400">
                    <span x-text="option"></span>
                </button>
            </template>
        </div>

        <!-- Question 2 : Mode de contact -->
        <p class="text-xl mb-4">Comment souhaitez-vous Ãªtre contactÃ© ?</p>
        <div class="flex flex-wrap justify-start gap-2 md:gap-4 mb-4">
            <template x-for="option in ['Accueil physique', 'TÃ©lÃ©phone', 'Mail']">
                <button 
                    type="button"
                    x-on:click="contactMode = option"
                    :class="contactMode === option ? 'bg-blue-500 text-white' : 'bg-gray-200 text-black'"
                    class="w-full md:w-auto px-4 py-2 rounded hover:bg-blue-400">
                    <span x-text="option"></span>
                </button>
            </template>
        </div>
      
        <!-- Bouton de validation -->
        <button
            type="button"
            x-on:click="if(country && contactMode){ 
                formAnswers.city = city;
                formAnswers.country = country;
                formAnswers.contactMode = contactMode;
                localStorage.setItem('formAnswers', JSON.stringify(formAnswers));
                console.log('Form1 - DonnÃ©es sauvegardÃ©es : ', JSON.parse(localStorage.getItem('formAnswers')));

                // Redirige vers l'Ã©tape 2 en conservant la ville dans l'URL
                window.location.href = '/' + city + '/form2';
            } else { 
                alert('Veuillez sÃ©lectionner un pays et un mode de contact.');
            }"
            class="w-full md:w-auto bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded">
            Valider
        </button>
    </main>
</body>
</html>
